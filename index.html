<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ¤è‚‰æº–å‚™å·¥ä½œå€ - è«è˜­è¿ªé¢¨æ ¼</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, 
                #f5f2f0 0%, 
                #ede7e0 25%, 
                #e8ddd4 50%, 
                #e2d6ca 75%, 
                #ddd0c0 100%);
            min-height: 100vh;
            color: #6b5b6f;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(215, 204, 200, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(205, 195, 185, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(195, 185, 175, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(245, 240, 235, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 
                0 8px 32px rgba(139, 131, 134, 0.1),
                0 4px 16px rgba(139, 131, 134, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(215, 204, 200, 0.2);
        }

        .event-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #8b8386;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(139, 131, 134, 0.1);
        }

        .event-date {
            font-size: 1.3rem;
            color: #a69ca0;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .event-address {
            font-size: 1.1rem;
            color: #b8aeb3;
            font-weight: 400;
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            align-items: start;
        }

        .add-section {
            background: rgba(240, 235, 230, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 
                0 8px 32px rgba(139, 131, 134, 0.1),
                0 4px 16px rgba(139, 131, 134, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(215, 204, 200, 0.3);
            position: sticky;
            top: 20px;
        }

        .add-section h2 {
            color: #8b8386;
            font-size: 1.4rem;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #9d9396;
            font-weight: 500;
            font-size: 0.95rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1.5px solid rgba(205, 195, 190, 0.4);
            border-radius: 12px;
            background: rgba(248, 245, 242, 0.8);
            backdrop-filter: blur(10px);
            color: #7a6d70;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: rgba(165, 155, 150, 0.6);
            background: rgba(250, 247, 244, 0.9);
            box-shadow: 0 0 0 3px rgba(165, 155, 150, 0.1);
        }

        .btn-add {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #c9bbb0 0%, #b8a99e 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            box-shadow: 
                0 4px 12px rgba(139, 131, 134, 0.2),
                0 2px 4px rgba(139, 131, 134, 0.1);
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 20px rgba(139, 131, 134, 0.25),
                0 4px 8px rgba(139, 131, 134, 0.15);
        }

        .btn-add:active {
            transform: translateY(0);
        }

        .list-section {
            background: rgba(250, 247, 244, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 
                0 8px 32px rgba(139, 131, 134, 0.1),
                0 4px 16px rgba(139, 131, 134, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(215, 204, 200, 0.3);
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .list-section h2 {
            color: #8b8386;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .filter-container {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .filter-select {
            min-width: 120px;
            padding: 8px 12px;
            border: 1.5px solid rgba(205, 195, 190, 0.4);
            border-radius: 8px;
            background: rgba(248, 245, 242, 0.8);
            color: #7a6d70;
            font-size: 0.9rem;
        }

        .task-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 
                0 4px 16px rgba(139, 131, 134, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .task-table th {
            background: linear-gradient(135deg, rgba(220, 210, 200, 0.7) 0%, rgba(210, 200, 190, 0.7) 100%);
            color: #8b8386;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            border-bottom: 1px solid rgba(205, 195, 190, 0.2);
        }

        .task-table td {
            padding: 16px;
            border-bottom: 1px solid rgba(205, 195, 190, 0.1);
            color: #7a6d70;
        }

        .task-table tr:hover {
            background: rgba(245, 240, 235, 0.5);
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-block;
            min-width: 70px;
            text-align: center;
        }

        .status-pending {
            background: linear-gradient(135deg, #d4c5c7 0%, #c9b8ba 100%);
            color: #8b7d7f;
        }

        .status-in-progress {
            background: linear-gradient(135deg, #c7d0c4 0%, #bcc7b9 100%);
            color: #7a8677;
        }

        .status-completed {
            background: linear-gradient(135deg, #b8c4d0 0%, #adb9c7 100%);
            color: #6d7a86;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-edit, .btn-delete {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-edit {
            background: linear-gradient(135deg, #c9bbb0 0%, #b8a99e 100%);
            color: white;
        }

        .btn-delete {
            background: linear-gradient(135deg, #d0b8b8 0%, #c7a9a9 100%);
            color: white;
        }

        .btn-edit:hover, .btn-delete:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(139, 131, 134, 0.2);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(139, 131, 134, 0.4);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(250, 247, 244, 0.95) 0%, rgba(245, 240, 235, 0.95) 100%);
            backdrop-filter: blur(30px);
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 
                0 20px 60px rgba(139, 131, 134, 0.3),
                0 8px 32px rgba(139, 131, 134, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(215, 204, 200, 0.3);
        }

        .close {
            color: #a69ca0;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #8b8386;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a69ca0;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .connection-test {
            background: rgba(245, 240, 235, 0.8);
            border: 1px solid rgba(215, 204, 200, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #c7d0c4 0%, #bcc7b9 100%);
            color: #7a8677;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .test-success {
            background: rgba(200, 230, 200, 0.3);
            border: 1px solid rgba(150, 200, 150, 0.5);
            color: #2d5a2d;
        }

        .test-error {
            background: rgba(255, 200, 200, 0.3);
            border: 1px solid rgba(255, 150, 150, 0.5);
            color: #8b4513;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .add-section {
                position: static;
            }
            
            .event-title {
                font-size: 2rem;
            }
            
            .filter-container {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="event-title">çƒ¤è‚‰æº–å‚™å·¥ä½œå€</h1>
            <div class="event-date">æ´»å‹•ï¼š9/28(æ—¥)ä¸‹åˆ15:30 é—”å®¶çƒ¤è‚‰è¬å®¶é¦™</div>
            <div class="event-address">åœ°å€ï¼šæ–°åŒ—å¸‚æ—å£å€ä»æ„›è·¯ä¸€æ®µ667å··23è™Ÿ</div>
        </div>

        <div class="main-content">
            <div class="add-section">
                <h2>æ–°å¢æº–å‚™äº‹é …</h2>
                
                <!-- é€£æ¥æ¸¬è©¦å€ -->
                <div class="connection-test">
                    <h3 style="color: #8b8386; margin-bottom: 15px; font-size: 1.1rem;">é€£æ¥æ¸¬è©¦</h3>
                    <button class="test-button" onclick="testConnection()">æ¸¬è©¦ API é€£æ¥</button>
                    <button class="test-button" onclick="testDirectCall()">ç›´æ¥èª¿ç”¨æ¸¬è©¦</button>
                    <div id="testResult"></div>
                </div>
                
                <form id="taskForm">
                    <div class="form-group">
                        <label for="itemName">äº‹é …åç¨±</label>
                        <input type="text" id="itemName" name="itemName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="category">åˆ†é¡</label>
                        <select id="category" name="category" required>
                            <option value="">é¸æ“‡åˆ†é¡</option>
                            <option value="é£Ÿæ">é£Ÿæ</option>
                            <option value="å™¨å…·">å™¨å…·</option>
                            <option value="èª¿æ–™">èª¿æ–™</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="quantity">æ•¸é‡</label>
                        <input type="text" id="quantity" name="quantity" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="responsible">è² è²¬äºº</label>
                        <input type="text" id="responsible" name="responsible" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">å‚™è¨»</label>
                        <textarea id="notes" name="notes" rows="3"></textarea>
                    </div>
                    
                    <button type="submit" class="btn-add">æ–°å¢äº‹é …</button>
                </form>
            </div>

            <div class="list-section">
                <div class="list-header">
                    <h2>æº–å‚™æ¸…å–®</h2>
                    <div class="filter-container">
                        <select id="statusFilter" class="filter-select">
                            <option value="">æ‰€æœ‰ç‹€æ…‹</option>
                            <option value="å¾…è™•ç†">å¾…è™•ç†</option>
                            <option value="é€²è¡Œä¸­">é€²è¡Œä¸­</option>
                            <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
                        </select>
                        <select id="categoryFilter" class="filter-select">
                            <option value="">æ‰€æœ‰åˆ†é¡</option>
                            <option value="é£Ÿæ">é£Ÿæ</option>
                            <option value="å™¨å…·">å™¨å…·</option>
                            <option value="èª¿æ–™">èª¿æ–™</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                </div>
                
                <div id="taskList">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ”¥</div>
                        <p>é‚„æ²’æœ‰æº–å‚™äº‹é …ï¼Œè¶•å¿«æ–°å¢å§ï¼</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 style="color: #8b8386; margin-bottom: 20px;">ç·¨è¼¯äº‹é …</h2>
            <form id="editForm">
                <div class="form-group">
                    <label for="editItemName">äº‹é …åç¨±</label>
                    <input type="text" id="editItemName" name="itemName" required>
                </div>
                
                <div class="form-group">
                    <label for="editCategory">åˆ†é¡</label>
                    <select id="editCategory" name="category" required>
                        <option value="é£Ÿæ">é£Ÿæ</option>
                        <option value="å™¨å…·">å™¨å…·</option>
                        <option value="èª¿æ–™">èª¿æ–™</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="editQuantity">æ•¸é‡</label>
                    <input type="text" id="editQuantity" name="quantity" required>
                </div>
                
                <div class="form-group">
                    <label for="editResponsible">è² è²¬äºº</label>
                    <input type="text" id="editResponsible" name="responsible" required>
                </div>
                
                <div class="form-group">
                    <label for="editNotes">å‚™è¨»</label>
                    <textarea id="editNotes" name="notes" rows="3"></textarea>
                </div>
                
                <button type="submit" class="btn-add">ä¿å­˜è®Šæ›´</button>
            </form>
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbxRK7Q2jL7bGDigcuL6XHthkH1PJPtEEaWarfl-DDTw9CBU7FI80Rl80mVJSLpmV7ac/exec';
        let tasks = [];
        let editingRowIndex = null;

        // Test functions
        function testConnection() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div style="color: #a69ca0;">æ¸¬è©¦ä¸­...</div>';
            
            // Test simple fetch request
            fetch(API_URL + '?action=read', {
                method: 'GET',
                mode: 'no-cors'
            })
            .then(() => {
                resultDiv.innerHTML = '<div class="test-success">âœ… APIé€£æ¥æ¸¬è©¦æˆåŠŸï¼šæœå‹™å™¨å¯é”</div>';
                // Now try JSONP
                testJSONP();
            })
            .catch(error => {
                resultDiv.innerHTML = `<div class="test-error">âŒ APIé€£æ¥å¤±æ•—ï¼š${error.message}</div>`;
            });
        }

        function testJSONP() {
            const resultDiv = document.getElementById('testResult');
            
            try {
                const callbackName = 'testCallback_' + Date.now();
                const script = document.createElement('script');
                const url = `${API_URL}?action=read&callback=${callbackName}`;
                
                // Set timeout
                const timeout = setTimeout(() => {
                    resultDiv.innerHTML += '<div class="test-error">âŒ JSONPè¶…æ™‚ï¼š10ç§’å…§ç„¡éŸ¿æ‡‰</div>';
                    document.head.removeChild(script);
                    delete window[callbackName];
                }, 10000);
                
                window[callbackName] = function(data) {
                    clearTimeout(timeout);
                    document.head.removeChild(script);
                    delete window[callbackName];
                    
                    resultDiv.innerHTML += `<div class="test-success">âœ… JSONPæ¸¬è©¦æˆåŠŸï¼š${JSON.stringify(data, null, 2)}</div>`;
                };
                
                script.onerror = function() {
                    clearTimeout(timeout);
                    resultDiv.innerHTML += '<div class="test-error">âŒ JSONPè…³æœ¬è¼‰å…¥å¤±æ•—</div>';
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                script.src = url;
                document.head.appendChild(script);
                
            } catch (error) {
                resultDiv.innerHTML += `<div class="test-error">âŒ JSONPæ¸¬è©¦ç•°å¸¸ï¼š${error.message}</div>`;
            }
        }

        function testDirectCall() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div style="color: #a69ca0;">æ­£åœ¨æ¸¬è©¦ç›´æ¥èª¿ç”¨...</div>';
            
            // Try different approaches
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = API_URL + '?action=read';
            
            iframe.onload = function() {
                resultDiv.innerHTML = '<div class="test-success">âœ… IFrameè¼‰å…¥æˆåŠŸï¼šæœå‹™å™¨éŸ¿æ‡‰æ­£å¸¸</div>';
                document.body.removeChild(iframe);
            };
            
            iframe.onerror = function() {
                resultDiv.innerHTML = '<div class="test-error">âŒ IFrameè¼‰å…¥å¤±æ•—ï¼šæœå‹™å™¨ç„¡éŸ¿æ‡‰</div>';
                document.body.removeChild(iframe);
            };
            
            document.body.appendChild(iframe);
        }

        // DOM Elements
        const taskForm = document.getElementById('taskForm');
        const taskList = document.getElementById('taskList');
        const statusFilter = document.getElementById('statusFilter');
        const categoryFilter = document.getElementById('categoryFilter');
        const editModal = document.getElementById('editModal');
        const editForm = document.getElementById('editForm');
        const closeModal = document.querySelector('.close');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é é¢è¼‰å…¥å®Œæˆ');
            
            // Auto test connection on load
            setTimeout(() => {
                testConnection();
            }, 2000);
            
            taskForm.addEventListener('submit', handleAddTask);
            editForm.addEventListener('submit', handleEditSubmit);
            statusFilter.addEventListener('change', renderTasks);
            categoryFilter.addEventListener('change', renderTasks);
            
            closeModal.addEventListener('click', closeEditModal);
            window.addEventListener('click', function(event) {
                if (event.target === editModal) {
                    closeEditModal();
                }
            });
        });

        // Simple add task function (local storage fallback)
        function handleAddTask(e) {
            e.preventDefault();
            
            const formData = new FormData(taskForm);
            const taskData = {
                id: Date.now(),
                itemName: formData.get('itemName'),
                category: formData.get('category'),
                quantity: formData.get('quantity'),
                responsible: formData.get('responsible'),
                notes: formData.get('notes') || '',
                status: 'å¾…è™•ç†',
                createdAt: new Date().toLocaleString()
            };

            // Try to add via API first, fallback to localStorage
            addTaskToAPI(taskData).catch(() => {
                addTaskToLocalStorage(taskData);
            });
        }

        function addTaskToAPI(taskData) {
            return new Promise((resolve, reject) => {
                try {
                    const callbackName = 'addCallback_' + Date.now();
                    const params = new URLSearchParams({
                        action: 'add',
                        callback: callbackName,
                        ...taskData
                    });
                    
                    const script = document.createElement('script');
                    const url = `${API_URL}?${params}`;
                    
                    const timeout = setTimeout(() => {
                        reject(new Error('API timeout'));
                        document.head.removeChild(script);
                        delete window[callbackName];
                    }, 5000);
                    
                    window[callbackName] = function(data) {
                        clearTimeout(timeout);
                        document.head.removeChild(script);
                        delete window[callbackName];
                        
                        if (data && data.success) {
                            taskForm.reset();
                            loadTasksFromAPI();
                            alert('æ–°å¢æˆåŠŸï¼');
                            resolve(data);
                        } else {
                            reject(new Error(data ? data.message : 'æœªçŸ¥éŒ¯èª¤'));
                        }
                    };
                    
                    script.onerror = function() {
                        clearTimeout(timeout);
                        reject(new Error('Script load error'));
                        document.head.removeChild(script);
                        delete window[callbackName];
                    };
                    
                    script.src = url;
                    document.head.appendChild(script);
                    
                } catch (error) {
                    reject(error);
                }
            });
        }

        function addTaskToLocalStorage(taskData) {
            try {
                const storedTasks = JSON.parse(localStorage.getItem('bbqTasks') || '[]');
                storedTasks.push(taskData);
                localStorage.setItem('bbqTasks', JSON.stringify(storedTasks));
                
                taskForm.reset();
                loadTasksFromLocalStorage();
                alert('æ–°å¢æˆåŠŸï¼ï¼ˆå·²ä¿å­˜åˆ°æœ¬åœ°ï¼‰');
            } catch (error) {
                alert('æ–°å¢å¤±æ•—: ' + error.message);
            }
        }

        function loadTasksFromAPI() {
            try {
                const callbackName = 'loadCallback_' + Date.now();
                const script = document.createElement('script');
                const url = `${API_URL}?action=read&callback=${callbackName}`;
                
                const timeout = setTimeout(() => {
                    console.log('APIè¼‰å…¥è¶…æ™‚ï¼Œåˆ‡æ›åˆ°æœ¬åœ°å­˜å„²');
                    loadTasksFromLocalStorage();
                    document.head.removeChild(script);
                    delete window[callbackName];
                }, 5000);
                
                window[callbackName] = function(data) {
                    clearTimeout(timeout);
                    document.head.removeChild(script);
                    delete window[callbackName];
                    
                    if (data && data.success) {
                        tasks = data.data || [];
                        renderTasks();
                    } else {
                        console.log('APIè¼‰å…¥å¤±æ•—ï¼Œåˆ‡æ›åˆ°æœ¬åœ°å­˜å„²');
                        loadTasksFromLocalStorage();
                    }
                };
                
                script.onerror = function() {
                    clearTimeout(timeout);
                    console.log('APIè…³æœ¬éŒ¯èª¤ï¼Œåˆ‡æ›åˆ°æœ¬åœ°å­˜å„²');
                    loadTasksFromLocalStorage();
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                script.src = url;
                document.head.appendChild(script);
                
            } catch (error) {
                console.log('è¼‰å…¥APIæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œåˆ‡æ›åˆ°æœ¬åœ°å­˜å„²:', error);
                loadTasksFromLocalStorage();
            }
        }

        function loadTasksFromLocalStorage() {
            try {
                tasks = JSON.parse(localStorage.getItem('bbqTasks') || '[]');
                renderTasks();
                
                if (tasks.length === 0) {
                    // Add some sample data
                    const sampleTasks = [
                        {
                            id: 1,
                            itemName: 'ç‰›è‚‰ç‰‡',
                            category: 'é£Ÿæ',
                            quantity: '2å…¬æ–¤',
                            responsible: 'çˆ¸çˆ¸',
                            notes: 'é¸æ“‡å„ªè³ªç‰›è‚‰',
                            status: 'å¾…è™•ç†',
                            createdAt: new Date().toLocaleString()
                        },
                        {
                            id: 2,
                            itemName: 'çƒ¤è‚‰æ¶',
                            category: 'å™¨å…·',
                            quantity: '1å€‹',
                            responsible: 'åª½åª½',
                            notes: 'å¤§å°ºå¯¸',
                            status: 'é€²è¡Œä¸­',
                            createdAt: new Date().toLocaleString()
                        }
                    ];
                    
                    tasks = sampleTasks;
                    localStorage.setItem('bbqTasks', JSON.stringify(tasks));
                    renderTasks();
                }
            } catch (error) {
                console.error('è¼‰å…¥æœ¬åœ°å­˜å„²å¤±æ•—:', error);
                tasks = [];
                renderTasks();
            }
        }

        // Render tasks
        function renderTasks() {
            const statusFilterValue = statusFilter.value;
            const categoryFilterValue = categoryFilter.value;
            
            let filteredTasks = tasks;
            
            if (statusFilterValue) {
                filteredTasks = filteredTasks.filter(task => task.status === statusFilterValue);
            }
            
            if (categoryFilterValue) {
                filteredTasks = filteredTasks.filter(task => task.category === categoryFilterValue);
            }

            if (filteredTasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ”¥</div>
                        <p>${tasks.length === 0 ? 'é‚„æ²’æœ‰æº–å‚™äº‹é …ï¼Œè¶•å¿«æ–°å¢å§ï¼' : 'æ²’æœ‰ç¬¦åˆç¯©é¸æ¢ä»¶çš„äº‹é …'}</p>
                    </div>
                `;
                return;
            }

            const tableHTML = `
                <table class="task-table">
                    <thead>
                        <tr>
                            <th>äº‹é …åç¨±</th>
                            <th>åˆ†é¡</th>
                            <th>æ•¸é‡</th>
                            <th>è² è²¬äºº</th>
                            <th>ç‹€æ…‹</th>
                            <th>å‚™è¨»</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredTasks.map((task, index) => {
                            const originalIndex = tasks.findIndex(t => t.id === task.id);
                            return `
                                <tr>
                                    <td>${task.itemName || ''}</td>
                                    <td>${task.category || ''}</td>
                                    <td>${task.quantity || ''}</td>
                                    <td>${task.responsible || ''}</td>
                                    <td>
                                        <span class="status-badge ${getStatusClass(task.status)}" 
                                              onclick="changeStatus(${originalIndex})">
                                            ${task.status || 'å¾…è™•ç†'}
                                        </span>
                                    </td>
                                    <td>${task.notes || ''}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-edit" onclick="handleEditClick(${originalIndex})">ç·¨è¼¯</button>
                                            <button class="btn-delete" onclick="handleDeleteClick(${originalIndex})">åˆªé™¤</button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            
            taskList.innerHTML = tableHTML;
        }

        function getStatusClass(status) {
            switch(status) {
                case 'å¾…è™•ç†': return 'status-pending';
                case 'é€²è¡Œä¸­': return 'status-in-progress';
                case 'å·²å®Œæˆ': return 'status-completed';
                default: return 'status-pending';
            }
        }

        function changeStatus(index) {
            if (index < 0 || index >= tasks.length) return;
            
            const currentStatus = tasks[index].status;
            let newStatus;
            
            switch(currentStatus) {
                case 'å¾…è™•ç†': newStatus = 'é€²è¡Œä¸­'; break;
                case 'é€²è¡Œä¸­': newStatus = 'å·²å®Œæˆ'; break;
                case 'å·²å®Œæˆ': newStatus = 'å¾…è™•ç†'; break;
                default: newStatus = 'é€²è¡Œä¸­';
            }
            
            tasks[index].status = newStatus;
            localStorage.setItem('bbqTasks', JSON.stringify(tasks));
            renderTasks();
        }

        function handleEditClick(index) {
            if (index < 0 || index >= tasks.length) return;
            
            editingRowIndex = index;
            const task = tasks[index];
            
            document.getElementById('editItemName').value = task.itemName || '';
            document.getElementById('editCategory').value = task.category || '';
            document.getElementById('editQuantity').value = task.quantity || '';
            document.getElementById('editResponsible').value = task.responsible || '';
            document.getElementById('editNotes').value = task.notes || '';
            
            editModal.style.display = 'block';
        }

        function handleEditSubmit(e) {
            e.preventDefault();
            
            if (editingRowIndex === null) return;
            
            const formData = new FormData(editForm);
            
            tasks[editingRowIndex] = {
                ...tasks[editingRowIndex],
                itemName: formData.get('itemName'),
                category: formData.get('category'),
                quantity: formData.get('quantity'),
                responsible: formData.get('responsible'),
                notes: formData.get('notes') || ''
            };
            
            localStorage.setItem('bbqTasks', JSON.stringify(tasks));
            closeEditModal();
            renderTasks();
            alert('ç·¨è¼¯æˆåŠŸï¼');
        }

        function handleDeleteClick(index) {
            if (index < 0 || index >= tasks.length) return;
            
            const task = tasks[index];
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${task.itemName}ã€å—ï¼Ÿ`)) {
                tasks.splice(index, 1);
                localStorage.setItem('bbqTasks', JSON.stringify(tasks));
                renderTasks();
                alert('åˆªé™¤æˆåŠŸï¼');
            }
        }

        function closeEditModal() {
            editModal.style.display = 'none';
            editingRowIndex = null;
            editForm.reset();
        }

        // Initialize on load
        setTimeout(() => {
            loadTasksFromLocalStorage();
        }, 1000);
    </script>
</body>
</html>
